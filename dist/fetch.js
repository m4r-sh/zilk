var q=({base:c="",routes:o=[],...f}={})=>({__proto__:new Proxy({},{get:($,_,s,j)=>(x,...A)=>o.push([_.toUpperCase?.(),RegExp(`^${(j=(c+x).replace(/\/+(\/|$)/g,"$1")).replace(/(\/?\.?):(\w+)\+/g,"($1(?<$2>*))").replace(/(\/?\.?):(\w+)/g,"($1(?<$2>[^$1/]+?))").replace(/\./g,"\\.").replace(/(\/?)\*/g,"($1.*)?")}/*$`),A,j])&&s}),routes:o,...f,async fetch($,..._){let s,j,x=new URL($.url),A=$.query={__proto__:null};for(let[r,O]of x.searchParams)A[r]=A[r]?[].concat(A[r],O):O;c:try{for(let r of f.before||[])if((s=await r($.proxy??$,..._))!=null)break c;o:for(let[r,O,U,L]of o)if((r==$.method||r=="ALL")&&(j=x.pathname.match(O))){$.params=j.groups||{},$.route=L;for(let R of U)if((s=await R($.proxy??$,..._))!=null)break o}}catch(r){if(!f.catch)throw r;s=await f.catch(r,$.proxy??$,..._)}try{for(let r of f.finally||[])s=await r(s,$.proxy??$,..._)??s}catch(r){if(!f.catch)throw r;s=await f.catch(r,$.proxy??$,..._)}return s}}),I=(c="text/plain; charset=utf-8",o)=>(f,$={})=>{if(f===void 0||f instanceof Response)return f;let _=new Response(o?.(f)??f,$.url?void 0:$);return _.headers.set("content-type",c),_},W=I("application/json; charset=utf-8",JSON.stringify),Q=(c)=>({400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error"})[c]||"Unknown Error",T=(c=500,o)=>{if(c instanceof Error){let{message:f,...$}=c;c=c.status||500,o={error:f||Q(c),...$}}return o={status:c,...typeof o=="object"?o:{error:o||Q(c)}},W(o,{status:c})},y=(c)=>{c.proxy=new Proxy(c.proxy??c,{get:(o,f)=>o[f]?.bind?.(c)??o[f]??o?.params?.[f]})},H=({format:c=W,missing:o=()=>T(404),finally:f=[],before:$=[],..._}={})=>q({before:[y,...$],catch:T,finally:[(s,...j)=>s??o(...j),c,...f],..._});var sc=I("text/plain; charset=utf-8",String),K=I("text/html"),Rc=I("image/jpeg"),jc=I("image/png"),Ac=I("image/webp");class S extends WeakMap{set(c,o){return super.set(c,o),o}}/*! (c) Andrea Giammarchi - ISC */var i=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,k=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,p=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,h=/[\x01\x02]/g,Y=(c,o,f)=>{let $=0;return c.join("\x01").trim().replace(k,(_,s,j,x)=>{let A=s+j.replace(p,"\x02=$2$1").trimEnd();if(x.length)A+=f||i.test(s)?" /":"></"+s;return"<"+A+">"}).replace(h,(_)=>_==="\x01"?"<!--"+o+$+++"-->":o+$++)};var{replace:V}="";var m=/[&<>'"]/g,d={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},n=(c)=>d[c],M=(c)=>V.call(c,m,n);var G=(c)=>c.replace(/(([A-Z0-9])([A-Z0-9][a-z]))|(([a-z])([A-Z]))/g,"$2$5-$3$6").toLowerCase();var N=(c)=>{let o;return(f)=>{if(o!==f)if(o=f,typeof f==="function")f(c);else f.current=c}};var{isArray:v}=Array,{toString:u}=Function,{keys:X}=Object,l=N(null),Z="isÂµ"+Date.now(),a=/([^\s>]+)[\s\S]*$/,e=new RegExp(`(<!--${Z}(\\d+)-->|\\s*${Z}(\\d+)=([^\\s>]))`,"g"),z=(c,o,f)=>` ${c}=${o}${M(f)}${o}`,C=(c)=>{switch(typeof c){case"string":return M(c);case"boolean":case"number":return String(c);case"object":switch(!0){case v(c):return c.map(C).join("");case c instanceof P:return c.toString()}break;case"function":return C(c())}return c==null?"":M(String(c))},cc=!1;class b{constructor(c,o){this._=(...f)=>c(...f,o)}}class P extends String{}var g=(c,o,f)=>{let $=Y(c,Z,f),_=[],s=0,j=null;while(j=e.exec($)){let A=$.slice(s,j.index);if(s=j.index+j[0].length,j[2])_.push((r)=>A+C(r));else{let r="",O=j[4];switch(O){case'"':case"'":let U=$.indexOf(O,s);r=$.slice(s,U),s=U+1;break;default:r=$.slice(--s).replace(a,"$1"),s+=r.length,O='"';break}switch(!0){case r==="aria":_.push((R)=>A+X(R).map(oc,R).join(""));break;case r==="ref":_.push((R)=>{return l(R),A});break;case r[0]==="?":let U=r.slice(1).toLowerCase();_.push((R)=>{let E=A;if(R)E+=` ${U}`;return E});break;case r[0]===".":let L=r.slice(1).toLowerCase();_.push(L==="dataset"?(R)=>A+X(R).filter((E)=>R[E]!=null).map(fc,R).join(""):(R)=>{let E=A;if(R!=null&&R!==!1)if(R===!0)E+=` ${L}`;else E+=z(L,O,R);return E});break;case r[0]==="@":r="on"+r.slice(1);case(r[0]==="o"&&r[1]==="n"):_.push((R)=>{let E=A;switch(typeof R){case"object":if(!(r in R))break;if(R=R[r],typeof R!=="function")break;case"function":if(R.toString===u)break;case"string":E+=z(r,O,R);break}return E});break;default:_.push((R)=>{let E=A;if(R!=null){if(cc&&R instanceof b){if(R=R._(null,r),R==null)return E}E+=z(r,O,R)}return E});break}}}let{length:x}=_;if(x!==o)throw new Error(`invalid template ${c}`);if(x){let A=_[x-1],r=$.slice(s);_[x-1]=(O)=>A(O)+r}else _.push(()=>$);return _};function oc(c){let o=M(this[c]);return c==="role"?` role="${o}"`:` aria-${c.toLowerCase()}="${o}"`}function fc(c){return` data-${G(c)}="${M(this[c])}"`}var F=new S,t=(c)=>{let o=(f,...$)=>{let{length:_}=$,s=F.get(f)||F.set(f,g(f,_,c));return new P(_?$.map(xc,s).join(""):s[0]())};return o.node=o,o.for=()=>o,o};var $c=t(!1),_c=t(!0),B=(c,o)=>{let f=(typeof o==="function"?o():o).toString();return typeof c==="function"?c(f):(c.write(f),c)};function xc(c,o){return this[o](c)}function D(c){if(typeof c==="string")return c;for(var o=c[0],f=1,$=arguments.length;f<$;f++)o+=arguments[f]+c[f];return o}function J(c,...o){let f=typeof c==="string"?[c]:c.raw,$=Array.isArray(c),_="";for(let x=0;x<f.length;x++){let A=$?f[x].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`").replace(/\\\$/g,"$").replace(/\\\{/g,"{"):f[x];if(_+=A,x<o.length){let r=o[x];if(typeof r==="string"&&r.includes(`
`)){let O=_.slice(_.lastIndexOf(`
`)+1).match(/^(\s+)/);if(O){let U=O[1];r=r.replace(/\n/g,`
${U}`)}}_+=r}}let s=_.split(`
`),j=Math.min(...s.map((x)=>x.match(/^(\s+)\S+/)).filter((x)=>x).map((x)=>x[1].length));return _=s.map((x)=>x[0]==" "||x[0]=="\t"?x.slice(j):x).join(`
`).trim(),$?_.replace(/\\n/g,`
`):_}var Nc=new Proxy(D,{get:(c,o)=>(...f)=>new P(D(...f))}),Xc=new Proxy(J,{get:(c,o)=>(...f)=>new P(J(...f))});function w(c){return RegExp("^"+("/"+c).replace(/\/+(\/|$)/g,"$1").replace(/(\/?\.?):(\w+)\+/g,"($1(?<$2>.*))").replace(/(\/?\.?):(\w+)/g,"($1(?<$2>[^$1/]+?))").replace(/\./g,"\\.").replace(/(\/?)\*/g,"($1.*)?")+"/*$")}function ic({pull:c,pages:o,redirects:f,template:$}){let _=H();async function s(j,x){if(j[c])x.pull=await j[c](x);let[A,r]=await Promise.all([j.meta(x),j.content(x)]),O=B(String,$({meta:A,content:r}));return K(O)}return _.all("*",(j)=>{let x=new URL(j.url);for(let[A,r]of Object.entries(f)){let O=w(A),U=x.pathname.match(O);if(U){let L=r;if(U.groups)L=r.replace(/\$(\d+)/g,(R,E)=>{return Object.values(U.groups)[parseInt(E)-1]||""});return Response.redirect(new URL(L,x.origin).toString(),301)}}}),Object.entries(o).forEach(([j,x])=>{_.get(j,(A)=>s(x,A))}),_.fetch}export{ic as createHandler};
